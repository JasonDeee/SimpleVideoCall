<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Logic - Video Call</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-result {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      input {
        padding: 8px;
        margin: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 300px;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test Logic Video Call P2P</h1>

    <div class="test-section">
      <h2>Test 1: Ki·ªÉm tra URL Hash</h2>
      <p>Nh·∫≠p URL c√≥ hash ƒë·ªÉ test logic:</p>
      <input
        type="text"
        id="testUrl"
        placeholder="https://example.com#call=abc123"
        value="https://example.com#call=abc123"
      />
      <button onclick="testUrlHash()">Test URL Hash</button>
      <div id="urlResult"></div>
    </div>

    <div class="test-section">
      <h2>Test 2: Ki·ªÉm tra Logic Call Button</h2>
      <p>Test xem n√∫t "G·ªçi" s·∫Ω l√†m g√¨ trong c√°c tr∆∞·ªùng h·ª£p kh√°c nhau:</p>
      <button onclick="testCallLogic(true, 'abc123')">
        Test: Ng∆∞·ªùi 1 (T·∫°o cu·ªôc g·ªçi m·ªõi)
      </button>
      <button onclick="testCallLogic(false, 'abc123')">
        Test: Ng∆∞·ªùi 2 (Tham gia cu·ªôc g·ªçi)
      </button>
      <div id="callResult"></div>
    </div>

    <div class="test-section">
      <h2>Test 3: Ki·ªÉm tra Connection ID</h2>
      <p>Test vi·ªác t·∫°o v√† qu·∫£n l√Ω Connection ID:</p>
      <button onclick="testConnectionId()">Test Connection ID</button>
      <div id="connectionResult"></div>
    </div>

    <div class="test-section">
      <h2>K·∫øt qu·∫£ t·ªïng h·ª£p</h2>
      <div id="summaryResult"></div>
    </div>

    <script>
      // Simulate the logic from the main app
      class TestVideoCallApp {
        constructor() {
          this.isInitiator = false;
          this.connectionId = null;
        }

        checkURLForConnection(url) {
          const hash = url.split("#")[1] || "";
          const match = hash.match(/call=([^&]+)/);

          if (match) {
            const connectionId = match[1];
            this.isInitiator = false;
            this.connectionId = connectionId;
            return {
              hasConnection: true,
              connectionId: connectionId,
              isInitiator: false,
              message: `ƒê√£ nh·∫≠n l·ªùi m·ªùi k·∫øt n·ªëi. Nh·∫•n "G·ªçi" ƒë·ªÉ tham gia.`,
            };
          } else {
            this.isInitiator = true;
            this.connectionId = null;
            return {
              hasConnection: false,
              connectionId: null,
              isInitiator: true,
              message: `S·∫µn s√†ng ƒë·ªÉ b·∫Øt ƒë·∫ßu cu·ªôc g·ªçi`,
            };
          }
        }

        handleCallButton() {
          if (this.connectionId && !this.isInitiator) {
            return {
              action: "joinCall",
              message: "Ng∆∞·ªùi 2: Tham gia cu·ªôc g·ªçi hi·ªán c√≥",
            };
          } else {
            return {
              action: "initiateCall",
              message: "Ng∆∞·ªùi 1: T·∫°o cu·ªôc g·ªçi m·ªõi",
            };
          }
        }

        generateConnectionId() {
          return (
            Math.random().toString(36).substring(2, 15) +
            Math.random().toString(36).substring(2, 15)
          );
        }
      }

      const testApp = new TestVideoCallApp();

      function testUrlHash() {
        const url = document.getElementById("testUrl").value;
        const result = testApp.checkURLForConnection(url);

        let html = `<div class="test-result info">
                <strong>URL:</strong> ${url}<br>
                <strong>Hash:</strong> ${url.split("#")[1] || "Kh√¥ng c√≥"}<br>
                <strong>Connection ID:</strong> ${
                  result.connectionId || "Kh√¥ng c√≥"
                }<br>
                <strong>Is Initiator:</strong> ${result.isInitiator}<br>
                <strong>Message:</strong> ${result.message}
            </div>`;

        document.getElementById("urlResult").innerHTML = html;
        updateSummary();
      }

      function testCallLogic(isInitiator, connectionId) {
        testApp.isInitiator = isInitiator;
        testApp.connectionId = connectionId;

        const result = testApp.handleCallButton();

        let html = `<div class="test-result ${
          result.action === "joinCall" ? "success" : "info"
        }">
                <strong>Tr·∫°ng th√°i:</strong> ${
                  isInitiator
                    ? "Ng∆∞·ªùi 1 (T·∫°o cu·ªôc g·ªçi)"
                    : "Ng∆∞·ªùi 2 (Tham gia cu·ªôc g·ªçi)"
                }<br>
                <strong>Connection ID:</strong> ${connectionId}<br>
                <strong>Action:</strong> ${result.action}<br>
                <strong>Message:</strong> ${result.message}
            </div>`;

        document.getElementById("callResult").innerHTML = html;
        updateSummary();
      }

      function testConnectionId() {
        const id1 = testApp.generateConnectionId();
        const id2 = testApp.generateConnectionId();

        let html = `<div class="test-result success">
                <strong>Connection ID 1:</strong> ${id1}<br>
                <strong>Connection ID 2:</strong> ${id2}<br>
                <strong>ƒê·ªô d√†i:</strong> ${id1.length} k√Ω t·ª±<br>
                <strong>Unique:</strong> ${id1 !== id2 ? "C√≥" : "Kh√¥ng"}
            </div>`;

        document.getElementById("connectionResult").innerHTML = html;
        updateSummary();
      }

      function updateSummary() {
        const summary = `
                <div class="test-result info">
                    <h3>‚úÖ Logic ƒë√£ ƒë∆∞·ª£c s·ª≠a:</h3>
                    <ul>
                        <li><strong>Ng∆∞·ªùi 1:</strong> Truy c·∫≠p URL g·ªëc ‚Üí Nh·∫•n "B·∫Øt ƒë·∫ßu" ‚Üí Nh·∫•n "G·ªçi" ‚Üí T·∫°o cu·ªôc g·ªçi m·ªõi v·ªõi URL m·ªõi</li>
                        <li><strong>Ng∆∞·ªùi 2:</strong> Truy c·∫≠p URL c√≥ hash ‚Üí Nh·∫•n "B·∫Øt ƒë·∫ßu" ‚Üí Nh·∫•n "G·ªçi" ‚Üí Tham gia cu·ªôc g·ªçi hi·ªán c√≥ (KH√îNG t·∫°o URL m·ªõi)</li>
                        <li><strong>Connection ID:</strong> ƒê∆∞·ª£c l∆∞u tr·ªØ v√† s·ª≠ d·ª•ng ƒë·ªÉ ph√¢n bi·ªát ng∆∞·ªùi t·∫°o vs ng∆∞·ªùi tham gia</li>
                        <li><strong>URL Hash:</strong> Ch·ªâ ƒë∆∞·ª£c t·∫°o b·ªüi ng∆∞·ªùi 1, ng∆∞·ªùi 2 gi·ªØ nguy√™n URL g·ªëc</li>
                    </ul>
                </div>
            `;
        document.getElementById("summaryResult").innerHTML = summary;
      }

      // Auto-run tests on page load
      window.onload = function () {
        testUrlHash();
        testCallLogic(true, null);
        testCallLogic(false, "abc123");
        testConnectionId();
      };
    </script>
  </body>
</html>
